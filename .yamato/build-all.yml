build-all:
  name: Build protobuf - all
  dependencies:
      - .yamato/build-linux-x64.yml
      - .yamato/build-macos-all.yml
      - .yamato/build-windows-all.yml#windows-c-libraries
      - .yamato/build-windows-all.yml#csharp-bindings

create-build-zip:
  name: Create Build Zip
  dependencies:
      - .yamato/build-all.yml#build-all

  agent:
    type: Unity::VM
    image: platform-foundation/windows-bokken:latest
    flavor: b1.small

  artifacts:
    builds:
      paths:
        - builds.zip

  commands:
    - choco install 7zip
    - mkdir builds\Google.Protobuf
    - move csharp\src\Google.Protobuf\bin builds\Google.Protobuf\
    - 7z a builds.zip .\builds\*
